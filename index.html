<!DOCTYPE html>
<meta charset="utf-8">

<title>Zotero library</title>
<link rel="stylesheet" href="css/style.css">

<script src="js/handlebars-1.0.rc.1.js"></script>
<script src="js/jquery-1.7.2.min.js"></script>

<!-- it takes the list that is called items in the JSON response (data) (to access it go to the url api.zotero.org/… bleow) and puts them in the template -->
<script id="entry-template" type="text/x-handlebars-template">
{{#each items}}
    <div class="collection-content {{#if data.parentItem}} attached-note {{/if}}" style="margin-top: 50px; font-size: 1.3em;">
        <!-- # is used to only output the data if they exist -->
        {{#if data.title}}<p class="item-reference"><em>{{ data.title }}</em>{{#if data.creators}}{{#each data.creators}}, {{ firstName }} {{ lastName }}{{/each}}{{/if}}{{#if data.publisher}}, {{ data.publisher }}{{/if}}{{#if data.date}}, {{ data.date }}{{/if}}
        </p>{{/if}}
        {{#if data.note}}
            <div class="text-bloc">{{{ data.note }}}</div>{{/if}}
        {{#if data.abstractNote}}
            <div class="text-bloc">Abstract: {{ data.abstractNote }}</div>
        {{/if}}
        {{#if data.tags}}<p>
            {{#each data.tags}} <span class="tag">{{ tag }}</span> {{/each}}</p>
        {{/if}}
    </div>
{{/each}}
</script>

<script>
$(function() {
    /* takes the entry-template element */
    var source = $("#entry-template").html();
    /* the jquery library Handelbars converts the template text into a template object*/
    var template = Handlebars.compile(source);

/* TO ADD A TITLE WHEN THERE IS NO TITLE
(but it doesn’t change the way it is ordered…)
    var processData = function(inData) {
        var outData = [];
        for (var i=0; i < inData.length; i++) {
            item = inData[i];
            // do things with item
            if (!item.data.title) {
                item.data.title = "Here is a title!"
            }
            outData.push(item);
        }
        return outData;
    }
*/


var processData = function(inData) {
    var obj = {}
    for (var i=0; i < inData.length; i++) {
        item = inData[i];
        // do things with item
        // create a new way of ordering things, easier to use
        // (not as a list like before but as an ‘object’ ~ dictionnary)
        obj[item.data.key] = item;
    }
    //TO ORDER THINGS IN A SPECIFIC WAY
    var getSortString = function(item) {
        if (!item.data.title) {
            if (item.data.parentItem) {
                return obj[item.data.parentItem].data.title + item.data.note;
            } else {
                return item.data.note;
            }
        }
        return item.data.title;
    }
    //takes everytime two objects of the array and compares them
    inData.sort(function(a, b) {
        a = getSortString(a);
        b = getSortString(b);
        if (a === b) return 0;
        if (a < b) return -1;
        if (a > b) return 1;
    });
    return inData;
}


    /* gets the collection from zotero */
 $.getJSON('https://api.zotero.org/groups/384780/collections/EGZFBCVH/items?key=1L6PZcpcAGt60UArycW14g7v&limit=100&sort=title', function(incomingData) {
     /* if the query succeeds, the response will be available as the variable “data”: */
     /* this variable is sent to the template above */
        var processedData = processData(incomingData);
        $("#items-container").html(template({ items: processedData }));
    });
});


</script>

<div class="container">
    <h1>Online</h1>
<h1>Open Reading Group</h1>

<div id="items-container">

</div>


<p style="border-top: 2px solid blue; margin-top: 50px; padding-top: 30px;"><a href="reading-room.html">reading-room</a></p><p>where you can comment on your readings</p>

<p style="border-top: 2px solid blue; margin-top: 50px; padding-top: 30px;"><a href="collaborative-libraries.html">collaborative libraries</a></p><p>a specific collection on “collective libraries”</p>

<p style="border-top: 2px solid blue; margin-top: 50px; padding-top: 30px;"><a href="https://www.zotero.org/groups/384780" target="_blank">more collections</a></p><p>can be added through the Zotero group</p>

<p style="border-top: 2px solid blue; margin-top: 50px; padding-top: 30px;"><a href="whole.html">the whole shared library</a></p><p>contains all the references shared in all the collections</p>

<p style="text-align: center; border-top: 2px solid blue; margin-top: 50px; padding-top: 30px;"><a href="https://www.zotero.org/groups/384780" target="_blank">join (through the Zotero group)</a></p>


<!-- NOTES:

Documentation on Zotero’s api:
https://www.zotero.org/support/dev/web_api/v3/basics

Get the key of a group online, observe the url
(to create a new key: https://www.zotero.org/settings/keys/new)

Specific format: CSLJSON
- Get every item in the database: https://api.zotero.org/users/1404902/items?key=fQAzFJXRib1RiqWRM2CUVeTq&format=csljson
- Get every books in the database:
https://api.zotero.org/users/1404902/items?key=fQAzFJXRib1RiqWRM2CUVeTq&format=csljson&limit=100&itemType=book
- Get only one specific item:
https://api.zotero.org/users/1404902/items/Q2TAUHDA?key=fQAzFJXRib1RiqWRM2CUVeTq&format=csljson
- Ref. citation style language csljson:
https://github.com/citation-style-language/schema/blob/master/csl-data.json
Another format: BIB
https://api.zotero.org/users/475425/collections/9KH9TNSJ/items?format=bib

-->
